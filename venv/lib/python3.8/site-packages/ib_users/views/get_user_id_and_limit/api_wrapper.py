from django_swagger_utils.drf_server.utils.decorator.interface_decorator \
    import validate_decorator
from .validator_class import ValidatorClass


@validate_decorator(validator_class=ValidatorClass)
def api_wrapper(*args, **kwargs):
    request_data = kwargs['request_data']
    referral_code = request_data['referral_code']

    from ib_users.interactors.referrals_interactor import ReferralsInteractor
    from ib_users.storages.referrals_storage_impl import ReferralsSQLStorage
    from ib_users.presenters.referrals_presenter_impl import \
        ReferralsPresenterJSON

    from ib_users.exceptions.referral_exceptions import InvalidReferralCode
    from django_swagger_utils.drf_server.exceptions import BadRequest

    storage = ReferralsSQLStorage()
    presenter = ReferralsPresenterJSON()
    interactor = ReferralsInteractor(storage=storage, presenter=presenter)

    try:
        referral_details = interactor.get_user_id_and_referral_limit(
            referral_code=referral_code)
    except InvalidReferralCode as exception:
        raise BadRequest(message=exception.message,
                         res_status=exception.error_type)

    return referral_details
