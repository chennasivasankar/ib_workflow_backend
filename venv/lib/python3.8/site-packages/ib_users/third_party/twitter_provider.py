from twython import Twython

from ib_users.interactors.third_party.twitter_provider \
    import TwitterProvider as SocialProvider, TWitterProfileDTO
from django.conf import settings


class TwitterProvider(SocialProvider):

    def get_user_profile(self, **kwargs):
        twitter_config = settings.TWITTER
        app_key = twitter_config['app_key']
        app_secret = twitter_config['app_secret']

        twitter = Twython(
            app_key=app_key,
            app_secret=app_secret,
            oauth_token=kwargs['social_access_token'],
            oauth_token_secret=kwargs['social_access_token_secret']
        )
        user = twitter.verify_credentials(
            include_email=True,
            include_entities=True,
            skip_status=False
        )

        return TWitterProfileDTO(
            name=user['name'],
            profile_pic=user['profile_image_url_https']
        )

