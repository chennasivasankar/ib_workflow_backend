import requests

from ib_users.interactors.third_party.google_provider \
    import GoogleProvider as SocialProvider, GoogleProfileDTO


class GoogleProvider(SocialProvider):

    def get_user_profile(self, **kwargs):
        user_info_url = "https://www.googleapis.com/oauth2/v2/userinfo"
        authorization_header = {
            "Authorization": "OAuth {}".format(kwargs['social_access_token'])
        }

        request_object = requests.get(
            user_info_url, headers=authorization_header, verify=False
        )
        google_plus_profile_details = request_object.json()
        if 'error' in google_plus_profile_details:
            raise Exception(google_plus_profile_details['error'])

        return GoogleProfileDTO(
            name=google_plus_profile_details['name'],
            profile_pic=google_plus_profile_details['picture']
        )
