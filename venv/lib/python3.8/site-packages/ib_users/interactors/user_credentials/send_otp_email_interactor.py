from ib_users.constants.otp_constants import OTPMessageFormatConstants
from ib_users.interactors.storages import UserAccountsStorage
from ib_users.interactors.third_party.otp_service import OTPService
from ib_users.validators import EmailValidator


class SendOTPEmailInteractor:
    def __init__(self, storage: UserAccountsStorage, otp_service: OTPService):
        self.storage = storage
        self.otp_service = otp_service

    def send_otp_to_email(self, email: str):
        EmailValidator.validate(email)
        self.storage.get_user_given_email(email=email)
        self.otp_service.send_otp_to_user_email(
            email=email,
            template=OTPMessageFormatConstants.FORMAT_TO_RESET_PASSWORD,
        subject=OTPMessageFormatConstants.OTP_SUBJECT_TO_RESET_PASSWORD)
