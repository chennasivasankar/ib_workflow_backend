from ib_users.interactors.storages import UserAccountsStorage
from ib_users.interactors.storages.user_password_reset_token_storage import \
    UserPasswordResetTokenStorage
from ib_users.validators import PasswordValidator


class SetPasswordGivenUserTokenInteractor:
    def __init__(self, token_storage: UserPasswordResetTokenStorage,
                 accounts_storage: UserAccountsStorage):
        self.token_storage = token_storage
        self.accounts_storage = accounts_storage

    def set_password_given_user_and_token(self, user_id: str, token: str,
                                          new_password: str):
        PasswordValidator.validate(new_password)
        self.token_storage.verify_token(user_id=user_id, token=token)
        self.accounts_storage.update_user_password(user_id=user_id,
                                                   new_password=new_password)