import abc
from dataclasses import dataclass
from typing import List

from ib_users.interactors.DTOs.common_dtos import PhoneNumberDTO
from ib_users.interactors.registration.DTOs.registration_dtos import \
    CreateAccountWithPhoneNumberDTO, CreateAccountWithEmailDTO
from ib_users.interactors.storages.user_account_base_storage import \
    UserAccountBaseStorage
from ib_users.models import UserAccount


@dataclass
class PhoneNumberAndPasswordDTO:
    phone_number_DTO: PhoneNumberDTO
    password: str


@dataclass
class UserNameAndPasswordDTO:
    username: str
    password: str


@dataclass
class EmailAndPasswordDTO:
    email: str
    password: str


@dataclass
class UserEmailAndPhoneNumberDTO:
    user_id: str
    email: str
    phone_number: PhoneNumberDTO


@dataclass
class UserAccountDTO:
    user_id: str
    username: str


@dataclass
class UserAccountWithProfileDTO:
    name: str
    username: str
    password: str
    email: str
    phone_number: str
    country_code: str


@dataclass
class UserProfileWithUsernameDTO:
    user_id: str
    name: str
    username: str
    email: str
    phone_number: str
    country_code: str


@dataclass
class UserAccountDTO:
    user_id: str
    username: str = None
    email: str = None
    phone_number: str = None
    country_code: str = None


class UserAccountsStorage(UserAccountBaseStorage):
    __metaclass__ = abc.ABCMeta

    @abc.abstractmethod
    def create_account_with_username(self, username: str, password: str) -> \
            str:
        pass

    @abc.abstractmethod
    def create_account_with_phone_number(
            self, create_account_dto: CreateAccountWithPhoneNumberDTO) -> str:
        pass

    @abc.abstractmethod
    def create_account_with_email(
            self, create_account_dto: CreateAccountWithEmailDTO) -> str:
        pass

    @abc.abstractmethod
    def check_user_exists_with_email(self, email: str):
        pass

    @abc.abstractmethod
    def check_user_exists_with_username(self, username: str):
        pass

    @abc.abstractmethod
    def check_user_exists_with_phone_number(self,
                                            phone_number_dto: PhoneNumberDTO):
        pass

    @abc.abstractmethod
    def get_user_id_given_username_and_password(
            self,
            username_login: UserNameAndPasswordDTO) -> str:
        pass

    @abc.abstractmethod
    def get_user_id_given_email_and_password(
            self,
            email_login: EmailAndPasswordDTO) -> str:
        pass

    @abc.abstractmethod
    def get_user_id_given_phone_number_and_password(
            self,
            phone_number_login: PhoneNumberAndPasswordDTO) -> str:
        pass

    @abc.abstractmethod
    def get_user_id_given_email(self, email: str) -> str:
        pass

    @abc.abstractmethod
    def get_existing_user_id_given_email(self, email:str) -> str:
        pass

    @abc.abstractmethod
    def get_user_id_given_phone_number(
            self,
            phone_number_dto: PhoneNumberDTO) -> str:
        pass

    @abc.abstractmethod
    def get_user_details_to_send_otp_given_email(
            self,
            email: str) -> UserEmailAndPhoneNumberDTO:
        pass

    @abc.abstractmethod
    def get_user_details_to_send_otp_given_phone_number(
            self,
            phone_number: PhoneNumberDTO) -> UserEmailAndPhoneNumberDTO:
        pass

    @abc.abstractmethod
    def update_username(self, current_username: str, new_username: str):
        pass

    @abc.abstractmethod
    def is_user_account_deactivated(self, user_id: str) -> bool:
        pass

    @abc.abstractmethod
    def activate_user(self, user_id: str):
        pass

    @abc.abstractmethod
    def deactivate_user_account(self, user_id: str):
        pass

    @abc.abstractmethod
    def is_user_id_exists(self, user_id: str) -> bool:
        pass

    @abc.abstractmethod
    def is_username_exists(self, username: str) -> bool:
        pass

    @abc.abstractmethod
    def link_phone_number_to_user(
            self, user_id: str, phone_number_dto: PhoneNumberDTO):
        pass

    @abc.abstractmethod
    def link_email_to_user(self, user_id: str, email: str):
        pass

    @abc.abstractmethod
    def check_current_password_matches(self, user_id: str,
                                       current_password: str):
        pass

    @abc.abstractmethod
    def update_user_password(self, user_id: str, new_password: str):
        pass

    @abc.abstractmethod
    def is_default_password_changed(self, user_id: str) -> bool:
        pass

    @abc.abstractmethod
    def get_user_given_username(self, username: str) -> UserAccount:
        pass

    @abc.abstractmethod
    def get_user_given_email(self, email: str) -> UserAccount:
        pass

    @abc.abstractmethod
    def get_user_given_phone_number(
            self, phone_number_dto: PhoneNumberDTO) -> UserAccount:
        pass

    @abc.abstractmethod
    def get_user_details_to_send_otp_given_username(self, username: str) -> \
            UserEmailAndPhoneNumberDTO:
        pass

    @abc.abstractmethod
    def get_user_details(self, user_id: str) -> UserProfileWithUsernameDTO:
        pass

    @abc.abstractmethod
    def get_user_account_details(self, user_id: str) -> UserAccountDTO:
        pass

    @abc.abstractmethod
    def get_user_details_for_usernames(self, usernames: List[str]) -> \
            [UserProfileWithUsernameDTO]:
        pass

    @abc.abstractmethod
    def get_user_email(self, user_id) -> str:
        pass

    @abc.abstractmethod
    def get_user_phone_number(self, user_id) -> str:
        pass

    @abc.abstractmethod
    def update_user_phone_number(self, user_id, phone_number, country_code):
        pass

    @abc.abstractmethod
    def update_email(self, user_id, email):
        pass

    @abc.abstractmethod
    def update_user_active_status(self, user_id: str, is_active: bool):
        pass
