from ib_users.interactors.logout.logout_in_devices import \
    LogoutInDevices
from ib_users.interactors.storages.user_login_device_details_storage import \
    UserLoginDeviceDetailsStorage, UserDeviceLoginDTO


class LoginUserToDevice:
    def __init__(self, storage: UserLoginDeviceDetailsStorage):
        self.storage = storage

    def create_given_login_device_mapping(
            self,
            user_device_login_dto: UserDeviceLoginDTO,
            restrict_access_to_specific_device=False,
            logout_in_devices_interactor: LogoutInDevices = None):
        if restrict_access_to_specific_device:
            logout_in_devices_interactor.logout_in_devices_except_of_given_access_tokens(
                user_id=user_device_login_dto.user_id,
                access_tokens=[user_device_login_dto.access_token]
            )
        self.storage.create_given_login_device_mapping_in_storage(
            user_device_login_dto=user_device_login_dto)
