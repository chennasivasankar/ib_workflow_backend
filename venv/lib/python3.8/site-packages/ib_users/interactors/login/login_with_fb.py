from ib_users.interactors.login.base_login import BaseLogin
from ib_users.interactors.storages.user_social_accounts_storage import \
    UserSocialAccountsStorage
from ib_users.interactors.third_party.social_account import SocialAccount


class LoginWithFB(BaseLogin):
    def __init__(self,
                 storage: UserSocialAccountsStorage,
                 fb_service: SocialAccount):
        super().__init__(storage)
        self.fb_service = fb_service

    def get_user_id_for_given_login_data(self,
                                         fb_access_token):
        social_id = self.fb_service.get_social_id(access_token=fb_access_token)
        user_id = self.storage.get_user_id_given_fb_social_id(
            social_id=social_id)
        super().validate_user_account_for_active_state(user_id)
        return user_id
