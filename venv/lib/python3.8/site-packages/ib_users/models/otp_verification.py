from django.db import models
from ib_common.models.abstract_date_time_model import AbstractDateTimeModel

from ib_users.constants.model_validators import COUNTRY_CODE_MAX_LENGTH, \
    PHONE_NUMBER_MAX_LENGTH, OTP_MAX_LENGTH, CONTEXT_MAX_LENGTH


class OTPVerification(AbstractDateTimeModel):
    """
    Represents OTP verification
    """

    country_code = models.CharField(
        max_length=COUNTRY_CODE_MAX_LENGTH,
        null=True,
        blank=True
    )
    phone_number = models.CharField(
        max_length=PHONE_NUMBER_MAX_LENGTH,
        null=True,
        blank=True
    )
    email = models.EmailField(null=True,
                              blank=True)
    otp = models.CharField(
        max_length=OTP_MAX_LENGTH
    )
    expiry_datetime = models.DateTimeField()
    retries_count = models.IntegerField(default=0)
    verification_type = models.CharField(max_length=CONTEXT_MAX_LENGTH)
    user_id = models.CharField(max_length=256, null=True, blank=True)

    def __str__(self):
        return "{} {} or {} or {}".format(self.country_code, self.phone_number,
                                          self.email, self.user_id)

    class Meta:
        app_label = 'ib_users'
