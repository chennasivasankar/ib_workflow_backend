import mock
from django_swagger_utils.utils.test import CustomAPITestCase

from ib_users.models import UserAccount

TEST_UUIDS = ['b46618fd-d64e-4b11-bb2e-14e0c67ecd4{}'.format(i) for i in range(
    9)]
UUID_POOL = iter(TEST_UUIDS)


def generate_uuid():
    """
    Generate UUIDs
    :return:
    """
    from uuid import UUID

    return iter([
        UUID('e360ac3e-81d9-4b85-8fb3-0ad19529953b'),
        UUID('827af7bf-6712-425c-b0d6-ec12cb9e4d33'),
        UUID('f4934b55-1ade-4445-b345-261647899efb'),
        UUID('9dd3a507-f749-4210-8093-3a529e949e13'),
        UUID('4d362f71-5cfc-485e-8d5c-cc91c68ff0f5'),
        UUID('526e682d-a715-4a5a-9372-3b10d8da5366'),
        UUID('f33eb5ef-f806-4d7c-9c00-75c72fedd772'),
        UUID('b546e4f5-74ed-42ee-ad92-3a95865148d3'),
        UUID('154a2229-07a2-4764-94bd-31e114f06ade'),
        UUID('dd39acee-860b-45be-855d-24dc2dc44f2e')
    ])


user_account_list = [
    {
        "user_id": "e360ac3e-81d9-4b85-8fb3-0ad19529953b",
        "username": "sampluser1"
    },
    {
        "user_id": "e360ac3e-81d9-4b85-8fb3-0ad19529953a",
        "username": "sampluser2"
    },
    {
        "user_id": "e360ac3e-81d9-4b85-8fb3-0ad19529953c",
        "username": "sampluser3"
    }
]

referral_details = [
    {
        "referral_code": "IBREF1",
        "referral_limit": 10
    },
    {
        "referral_code": "IBREF2",
        "referral_limit": 10
    },
    {
        "referral_code": "NEWREF",
        "referral_limit": 10
    },
]


class CustomTestReferralUtils(CustomAPITestCase):

    @staticmethod
    def create_user_account_with_userid_and_username():
        user_account_objs_list = []
        for user_account in user_account_list:
            user_account_obj = UserAccount(user_id=user_account["user_id"],
                                           username=user_account["username"])
            user_account_objs_list.append(user_account_obj)

        return UserAccount.objects.bulk_create(user_account_objs_list)

    @staticmethod
    def populate_referral_details(user_account_objs):
        from ib_users.models.referral_details import ReferralDetails
        referral_obj = ReferralDetails.objects.create(
            referral_code="IBREF1",
            referral_limit=10,
            user_account=user_account_objs[1]
        )
        ReferralDetails.objects.create(
            referral_code="IBREF2",
            referral_limit=10,
            user_account=user_account_objs[0],
            referred_by=referral_obj
        )
        ReferralDetails.objects.create(
            referral_code="NEWREF",
            referral_limit=10,
            user_account=user_account_objs[2]
        )

    @mock.patch(
        'ib_users.utils.referral_code_utils.generate_new_referral_code',
        lambda: "DUMMY1")
    def default_test_case(self):
        return super().default_test_case()
