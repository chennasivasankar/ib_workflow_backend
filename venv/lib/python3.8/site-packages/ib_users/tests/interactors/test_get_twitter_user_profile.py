from mock import create_autospec


def test_get_twitter_user_profile():
    from ib_users.interactors.twitter_interactor \
        import TwitterInteractor,TwitterProfileDTO
    from ib_users.interactors.presenters.twitter_presenter \
        import TwitterPresenter

    from ib_users.interactors.third_party.twitter_provider \
        import TwitterProvider

    twitter_provider_mock = create_autospec(TwitterProvider)
    twitter_presenter_mock = create_autospec(TwitterPresenter)

    twitter_interactor = TwitterInteractor(
        provider=twitter_provider_mock,
        presenter=twitter_presenter_mock
    )

    access_token = 'twitter_access_token'

    twitter_user_profile = TwitterProfileDTO(
        name="John",
        profile_image_url_https="https:\/\/pbs.twimg.com\/profile_images\/942858479592554497\/BbazLO9L_normal.jpg"
    )

    twitter_provider_mock.get_user_profile.return_value = twitter_user_profile

    twitter_interactor.get_twitter_user_profile_by_access_token(access_token=access_token)

    twitter_provider_mock.get_user_profile.assert_called_once_with(access_token=access_token)

    twitter_presenter_mock.get_user_profile.assert_called_once_with(twitter_user_profile)
