from mock import create_autospec


def test_generate_time_based_code_for_user_return_code():
    from ib_users.interactors.user_profile_interactor import UserProfileInteractor
    from ib_users.interactors.storages.user_profile_storage import UserProfileStorage
    from ib_users.interactors.third_party.otp_provider import OTPProvider
    from ib_users.interactors.presenters.user_profile_presenter import UserProfilePresenter

    storage_mock = create_autospec(UserProfileStorage)
    presenter_mock = create_autospec(UserProfilePresenter)

    json_user_code = {"user_code": "123456"}

    presenter_mock.generate_user_code.return_value = json_user_code

    user_profile_interactor = UserProfileInteractor(
        storage=storage_mock, presenter=presenter_mock)

    otp_provider_mock = create_autospec(OTPProvider)

    user_id = 1
    configured_time_in_seconds = 10

    otp_provider_mock.generate_time_based_code_for_user.return_value = "123456"

    user_code = user_profile_interactor.generate_time_based_code_for_user(
        otp_provider=otp_provider_mock,
        user_id=user_id, configured_time_in_seconds=configured_time_in_seconds)

    assert user_code == json_user_code
