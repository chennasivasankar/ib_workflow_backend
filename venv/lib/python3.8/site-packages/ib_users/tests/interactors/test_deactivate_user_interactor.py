from mock import create_autospec

from ib_users.interactors.storages import UserAccountsStorage
from ib_users.third_party.oauth_user_auth_tokens_service import \
    OAuthUserAuthTokensService


class TestDeactivateUserInteractor:

    def test_deactivate(self):
        # Arrange
        user_id = "1"
        storage = create_autospec(UserAccountsStorage)
        auth_service = create_autospec(OAuthUserAuthTokensService)

        from ib_users.interactors.deactivate_user_interactor import \
            DeactivateUserInteractor
        interactor = DeactivateUserInteractor(
            storage=storage, auth_service=auth_service
        )

        # ACT
        interactor.deactivate(user_id=user_id)

        # Assert
        storage.update_user_active_status.assert_called_once_with(
            user_id=user_id, is_active=False
        )
        auth_service.expire_all_user_tokens.assert_called_once_with(
            user_id=user_id
        )
